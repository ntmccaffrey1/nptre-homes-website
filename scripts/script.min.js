let resizeTimeout;const lenis=new Lenis({duration:1,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),smooth:!0,smoothTouch:!1});function lenisScroll(){function e(t){document.body.classList.contains("ov-hidden")||lenis.raf(t),requestAnimationFrame(e)}requestAnimationFrame(e)}function refreshLenis(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{requestAnimationFrame(()=>{lenis.resize()})},300)}function bodyFadeInOut(){window.addEventListener("pageshow",e=>{document.body.classList.remove("page-exit")}),document.addEventListener("click",e=>{let t=e.target.closest("a[href]");if(!t)return;let s=t.getAttribute("href");!s||s.startsWith("#")||"_blank"===t.target||s.startsWith("http")||s.startsWith("mailto:")||(e.preventDefault(),document.body.classList.add("page-exit"),setTimeout(()=>{window.location.href=s},400))})}function isElementInViewport(e){let t=e.getBoundingClientRect();return t.top<window.innerHeight&&t.bottom>0&&t.left<window.innerWidth&&t.right>0}function staggerFade(){let e=document.querySelectorAll(".stagger-fade");e.forEach(e=>{let t=e.textContent.trim().split(" ");e.innerHTML=t.map(e=>`<span>${e}</span>`).join(" ");let s=e.querySelectorAll("span"),n=new IntersectionObserver(([t])=>{t.isIntersecting&&(s.forEach((e,t)=>{e.style.transitionDelay=`${100*t}ms`}),e.classList.add("visible"),n.unobserve(e))},{threshold:.5});n.observe(e)})}function fadeOutOnScroll(e,t=500){let s=document.querySelector(e);s&&window.addEventListener("scroll",function(){let e=Math.max(0,1-window.scrollY/t);s.style.opacity=e},{passive:!0})}function scrollProgressBar(){window.addEventListener("scroll",()=>{let e=document.getElementById("scroll-progress");if(!e)return;let t=window.scrollY,s=document.documentElement.scrollHeight-window.innerHeight;e.style.width=t/s*100+"%"},{passive:!0})}function fadeInElements(){let e=document.querySelectorAll(".initial-blur");function t(){e.forEach(e=>{isElementInViewport(e)&&e.classList.add("visible")})}window.addEventListener("scroll",t),t()}function waitBefore(){let e=document.querySelector(".project-hero"),t=document.querySelector(".hero");if(e){let s=e.querySelector("img");s&&(s.complete?e.classList.add("img-loaded"):s.addEventListener("load",()=>{e.classList.add("img-loaded")}))}if(t){let n=t.querySelector(".hero-image img");n&&(n.complete?t.classList.add("img-loaded"):n.addEventListener("load",()=>{t.classList.add("img-loaded")}))}}function heroSlider(){let e=document.querySelectorAll(".hero-image"),t=document.getElementById("slider-nav");if(!e.length||!t)return;t.setAttribute("role","tablist");let s=0,n=!1,r=[],l={play:'<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>',pause:'<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'};function i(t){var l;(l=r[s])._progressFrame&&(cancelAnimationFrame(l._progressFrame),l.style.setProperty("--progress","0%"),l._elapsed=0),e[s].classList.remove("incoming"),e[s].setAttribute("aria-hidden","true"),r[s].classList.remove("active"),r[s].setAttribute("aria-selected","false"),e[s=t].classList.add("incoming"),e[s].setAttribute("aria-hidden","false"),r[s].classList.add("active"),r[s].setAttribute("aria-selected","true"),o(),n||a(r[s],5e3,0,()=>{i((s+1)%e.length)})}function o(){r.forEach((e,t)=>{e.classList.toggle("active",t===s),e.setAttribute("aria-selected",t===s?"true":"false"),e.setAttribute("tabindex",t===s?"0":"-1"),e.innerHTML=t===s?n?l.play:l.pause:t+1})}function a(e,t,s=0,n=()=>{}){let r=null;function l(i){r||(r=i-s);let o=i-r;e.style.setProperty("--progress",`${100*Math.min(o/t,1)}%`),e._elapsed=o,o<t?e._progressFrame=requestAnimationFrame(l):(e._elapsed=0,n())}e._progressFrame&&cancelAnimationFrame(e._progressFrame),e._progressFrame=requestAnimationFrame(l)}e.forEach((l,c)=>{let d=document.createElement("button");d.type="button",d.classList.add("nav-btn"),d.textContent=c+1,d.setAttribute("role","tab"),d.setAttribute("aria-label",`Go to slide ${c+1}`),d.setAttribute("aria-selected","false"),d.setAttribute("tabindex",0===c?"0":"-1"),d.addEventListener("click",()=>{var t;return t=c,void(t===s?function t(){n=!n,o();let l=r[s];if(n)cancelAnimationFrame(l._progressFrame);else{let c=l._elapsed||0;a(l,5e3,c,()=>{i((s+1)%e.length)})}}():i(t))}),t.appendChild(d),r.push(d)}),t.addEventListener("keydown",e=>{let t=r.findIndex(e=>e===document.activeElement);if("ArrowRight"===e.key||"ArrowLeft"===e.key){e.preventDefault();let s="ArrowRight"===e.key?1:-1,n=(t+s+r.length)%r.length;r[n].focus(),i(n)}}),window.addEventListener("load",()=>{let e=document.querySelector(".hero-image.scale-in");e&&setTimeout(()=>{e.classList.remove("scale-in")},1e3)}),e.forEach((e,t)=>{e.setAttribute("aria-hidden",t===s?"false":"true")}),e[s].classList.add("incoming"),r[s].classList.add("active"),o(),a(r[s],5e3,0,()=>{i((s+1)%e.length)})}function backToHomes(){let e=document.querySelector(".back-button");e&&window.addEventListener("scroll",()=>{window.scrollY>100?e.classList.add("visible"):e.classList.remove("visible")},{passive:!0})}function menuToggle(){let e=document.getElementById("hamburger"),t=document.getElementById("menu"),s=document.getElementById("menu__overlay");if(!(e&&t&&s))return;let n=n=>{let r=(e,t,s=!0)=>e.classList[s?"add":"remove"](t);e.classList.toggle("active"),n?(r(t,"show",!1),r(t,"closing"),r(s,"show",!1),document.body.classList.remove("ov-hidden"),lenis.start(),setTimeout(()=>r(t,"closing",!1),400)):(r(t,"show"),r(s,"show"),document.body.classList.add("ov-hidden"),lenis.stop())};e.addEventListener("click",()=>{let e=t.classList.contains("show");n(e)})}function setActiveLink(){if(window.innerWidth<=992)return;let e=document.querySelectorAll(".main-menu a"),t=window.location.pathname,s=null;e.forEach(e=>{let n=new URL(e.getAttribute("href"),window.location.origin).pathname,r=n.endsWith("/homes")&&t.startsWith("/homes/");(n===t||r)&&(e.classList.add("active"),s=e)});let n=(t=null)=>{e.forEach(e=>{e.style.opacity=t?e===t?"1":"0.3":s?e===s?"1":"0.3":"1"})};e.forEach(e=>{e.addEventListener("mouseenter",()=>n(e)),e.addEventListener("mouseleave",()=>n())}),n()}function subNavHoverEffect(){let e=document.querySelectorAll(".hover-link");if(!e.length)return;let t=null,s=e[0],n=document.getElementById(`${s.id}-img`);n&&(n.style.opacity="1",t=n),s.style.opacity="1",e.forEach(s=>{s.addEventListener("mouseenter",()=>{let n=document.getElementById(`${s.id}-img`);n&&n!==t&&(t?.style.setProperty("opacity","0"),n.style.opacity="1",t=n),e.forEach(e=>e.style.opacity=e===s?"1":"0.3")})})}function lazyImages(){if("IntersectionObserver"in window){let e=document.querySelectorAll("img.lazy"),t=(e,t)=>{e.forEach(e=>{if(e.isIntersecting){let s=e.target;s.src=s.getAttribute("data-src"),s.classList.remove("lazy"),t.unobserve(s)}})},s=new IntersectionObserver(t,{root:null,rootMargin:"0px 0px -25px 0px"});e.forEach(e=>{s.observe(e)})}else{let n=document.querySelectorAll("img.lazy");n.forEach(e=>{e.src=e.getAttribute("data-src")})}}function gallery(){let e=document.getElementById("image-popup");if(!e)return;let t=e.querySelector(".popup-image"),s=e.querySelector(".close-btn"),n=e.querySelector(".next-btn"),r=e.querySelector(".prev-btn"),l=e.querySelector(".popup-counter"),i=Array.from(document.querySelectorAll(".gallery-image img")),o=0,a=0,c=0,d=0;function u(){let e=i[o],s=e.src||e.dataset.src,n=e.alt||"";t.classList.remove("visible");let r=new Image;r.onload=()=>{t.src=s,t.alt=n,l.textContent=`${o+1} / ${i.length}`,setTimeout(()=>t.classList.add("visible"),50)},r.src=s}function h(t){o=t,e.classList.add("show"),document.body.classList.add("ov-hidden"),lenis.stop(),setTimeout(u,10)}function g(){o=(o+1)%i.length,u()}function f(){o=(o-1+i.length)%i.length,u()}s?.addEventListener("click",function s(){e.classList.remove("show"),setTimeout(()=>{t.src="",l.textContent="",document.body.classList.remove("ov-hidden"),lenis.start()},300)}),n?.addEventListener("click",g),r?.addEventListener("click",f),t.addEventListener("touchstart",function e(t){t.touches.length>1||(a=c=t.touches[0].screenX,d=Date.now())},{passive:!0}),t.addEventListener("touchmove",function e(t){t.touches.length>1||(c=t.touches[0].screenX)},{passive:!0}),t.addEventListener("touchend",function e(){let t=c-a,s=Date.now()-d;Math.abs(t)>50&&s<500&&(t<0?g():f()),a=c=d=0},{passive:!0}),i.forEach((e,t)=>e.addEventListener("click",()=>h(t))),document.querySelector(".open-gallery")?.addEventListener("click",()=>{i.length&&h(0)})}function projectFullSlider(){let e=document.querySelectorAll(".slide"),t=document.getElementById("project-slider"),s=document.getElementById("slide-counter"),n=document.getElementById("arrow-up"),r=document.getElementById("arrow-down"),l=document.querySelector(".fullpage-wrapper");if(!t||!s||!e.length||!l)return;let i=0,o=!1,a=0,c=!1;function d(){let e=window.innerHeight;l.style.height=`${e}px`,document.querySelectorAll(".project-hero, .slide").forEach(t=>{t.style.height=`${e}px`}),function e(){let s=window.innerHeight;t.style.transform=`translateY(-${i*s}px)`}()}function u(){s.textContent=`${i+1} / ${e.length}`}function h(s){if(o||s<0||s>=e.length)return;i=s;let l=window.innerHeight;t.style.transform=`translateY(-${i*l}px)`,e.forEach((e,t)=>{e.classList.toggle("active",t===i)}),n.disabled=0===i,r.disabled=i===e.length-1,u(),function e(t){let s=t.querySelector("img");s&&(s.classList.remove("image-pre-fade"),s.style.animation="none",s.offsetHeight,s.classList.add("image-pre-fade"),setTimeout(()=>{s.style.animation="fadeScaleIn 0.6s ease-out forwards"},500))}(e[i]),o=!0,setTimeout(()=>o=!1,1e3)}function g(){i<e.length-1&&h(i+1)}function f(){i>0&&h(i-1)}window.addEventListener("load",()=>{d(),u()}),window.addEventListener("resize",d),l.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),n?.addEventListener("click",f),r?.addEventListener("click",g),window.addEventListener("wheel",e=>{o||(e.deltaY>0?g():f())},{passive:!0}),window.addEventListener("touchstart",e=>{a=e.touches[0].clientY,c=!0},{passive:!0}),window.addEventListener("touchend",e=>{if(!c||o)return;let t=a-e.changedTouches[0].clientY;Math.abs(t)>50&&(t>0?g():f()),c=!1})}function bodyFadeInOut(){let e=document.getElementById("transition-overlay");window.addEventListener("pageshow",()=>{document.body.classList.remove("page-exit"),e?.classList.remove("show")}),document.addEventListener("click",t=>{let s=t.target.closest("a[href]");if(!s)return;let n=s.getAttribute("href"),r=n.startsWith("http")||n.startsWith("mailto:");!n||n.startsWith("#")||r||"_blank"===s.target||(t.preventDefault(),e?.classList.add("show"),setTimeout(()=>{window.location.href=n},400))})}function loadHeader(){return fetch("../utilities/header.html").then(e=>e.text()).then(e=>{document.getElementById("header").innerHTML=e})}function loadFooter(){return fetch("../utilities/footer.html").then(e=>e.text()).then(e=>{document.getElementById("footer").innerHTML=e})}function initializeComponents(){scrollProgressBar(),backToHomes(),bodyFadeInOut(),staggerFade(),gallery(),fadeOutOnScroll(".project_down_arrow"),fadeOutOnScroll(".fade-out-element"),fadeInElements(),heroSlider(),lazyImages(),lenisScroll(),projectFullSlider(),waitBefore()}window.addEventListener("load",refreshLenis),document.addEventListener("DOMContentLoaded",()=>{loadHeader().then(()=>{menuToggle(),subNavHoverEffect(),setActiveLink()}).catch(e=>console.error("Failed to load header:",e)),document.body.classList.contains("no-footer")||loadFooter().catch(e=>console.error("Failed to load footer:",e)),initializeComponents()});