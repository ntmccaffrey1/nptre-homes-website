let resizeTimeout;const lenis=new Lenis({duration:1,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),smooth:!0,smoothTouch:!1});function lenisScroll(){function e(t){document.body.classList.contains("ov-hidden")||lenis.raf(t),requestAnimationFrame(e)}requestAnimationFrame(e)}function refreshLenis(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{requestAnimationFrame(()=>{lenis.resize()})},300)}function bodyFadeInOut(){window.addEventListener("pageshow",e=>{document.body.classList.remove("page-exit")}),document.addEventListener("click",e=>{let t=e.target.closest("a[href]");if(!t)return;let n=t.getAttribute("href");!n||n.startsWith("#")||"_blank"===t.target||n.startsWith("http")||n.startsWith("mailto:")||(e.preventDefault(),document.body.classList.add("page-exit"),setTimeout(()=>{window.location.href=n},400))})}function isElementInViewport(e){let t=e.getBoundingClientRect();return t.top<window.innerHeight&&t.bottom>0&&t.left<window.innerWidth&&t.right>0}function staggerFade(){let e=document.querySelectorAll(".stagger-fade");e.forEach(e=>{let t=e.textContent.trim().split(" ");e.innerHTML=t.map(e=>`<span>${e}</span>`).join(" ");let n=e.querySelectorAll("span"),r=new IntersectionObserver(([t])=>{t.isIntersecting&&(n.forEach((e,t)=>{e.style.transitionDelay=`${100*t}ms`}),e.classList.add("visible"),r.unobserve(e))},{threshold:.5});r.observe(e)})}function fadeOutOnScroll(e,t=500){let n=document.querySelector(e);n&&window.addEventListener("scroll",function(){let e=Math.max(0,1-window.scrollY/t);n.style.opacity=e})}function scrollProgressBar(){window.addEventListener("scroll",()=>{let e=document.getElementById("scroll-progress");if(!e)return;let t=window.scrollY,n=document.documentElement.scrollHeight-window.innerHeight;e.style.width=t/n*100+"%"})}function fadeInElements(){let e=document.querySelectorAll(".initial-blur");function t(){e.forEach(e=>{isElementInViewport(e)&&e.classList.add("visible")})}window.addEventListener("scroll",t),t()}function waitBefore(){let e=document.querySelector(".project-hero"),t=document.querySelector(".hero");if(e){let n=e.querySelector("img");n&&(n.complete?e.classList.add("img-loaded"):n.addEventListener("load",()=>{e.classList.add("img-loaded")}))}if(t){let r=t.querySelector(".hero-image img");r&&(r.complete?t.classList.add("img-loaded"):r.addEventListener("load",()=>{t.classList.add("img-loaded")}))}}function heroSlider(){let e=document.querySelectorAll(".hero-image"),t=document.getElementById("slider-nav");if(!e.length||!t)return;t.setAttribute("role","tablist");let n=0,r=!1,l=[],s={play:'<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>',pause:'<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'};function i(t){var s;(s=l[n])._progressFrame&&(cancelAnimationFrame(s._progressFrame),s.style.setProperty("--progress","0%"),s._elapsed=0),e[n].classList.remove("incoming"),e[n].setAttribute("aria-hidden","true"),l[n].classList.remove("active"),l[n].setAttribute("aria-selected","false"),e[n=t].classList.add("incoming"),e[n].setAttribute("aria-hidden","false"),l[n].classList.add("active"),l[n].setAttribute("aria-selected","true"),o(),r||a(l[n],5e3,0,()=>{i((n+1)%e.length)})}function o(){l.forEach((e,t)=>{e.classList.toggle("active",t===n),e.setAttribute("aria-selected",t===n?"true":"false"),e.setAttribute("tabindex",t===n?"0":"-1"),e.innerHTML=t===n?r?s.play:s.pause:t+1})}function a(e,t,n=0,r=()=>{}){let l=null;function s(i){l||(l=i-n);let o=i-l;e.style.setProperty("--progress",`${100*Math.min(o/t,1)}%`),e._elapsed=o,o<t?e._progressFrame=requestAnimationFrame(s):(e._elapsed=0,r())}e._progressFrame&&cancelAnimationFrame(e._progressFrame),e._progressFrame=requestAnimationFrame(s)}e.forEach((s,c)=>{let d=document.createElement("button");d.type="button",d.classList.add("nav-btn"),d.textContent=c+1,d.setAttribute("role","tab"),d.setAttribute("aria-label",`Go to slide ${c+1}`),d.setAttribute("aria-selected","false"),d.setAttribute("tabindex",0===c?"0":"-1"),d.addEventListener("click",()=>{var t;return t=c,void(t===n?function t(){r=!r,o();let s=l[n];if(r)cancelAnimationFrame(s._progressFrame);else{let c=s._elapsed||0;a(s,5e3,c,()=>{i((n+1)%e.length)})}}():i(t))}),t.appendChild(d),l.push(d)}),t.addEventListener("keydown",e=>{let t=l.findIndex(e=>e===document.activeElement);if("ArrowRight"===e.key||"ArrowLeft"===e.key){e.preventDefault();let n="ArrowRight"===e.key?1:-1,r=(t+n+l.length)%l.length;l[r].focus(),i(r)}}),window.addEventListener("load",()=>{let e=document.querySelector(".hero-image.scale-in");e&&setTimeout(()=>{e.classList.remove("scale-in")},1e3)}),e.forEach((e,t)=>{e.setAttribute("aria-hidden",t===n?"false":"true")}),e[n].classList.add("incoming"),l[n].classList.add("active"),o(),a(l[n],5e3,0,()=>{i((n+1)%e.length)})}function backToHomes(){let e=document.querySelector(".back-button");e&&window.addEventListener("scroll",()=>{window.scrollY>100?e.classList.add("visible"):e.classList.remove("visible")})}function menuToggle(){let e=document.getElementById("hamburger"),t=document.getElementById("menu"),n=document.getElementById("menu__overlay");if(!(e&&t&&n))return;let r=r=>{let l=(e,t,n=!0)=>e.classList[n?"add":"remove"](t);e.classList.toggle("active"),r?(l(t,"show",!1),l(t,"closing"),l(n,"show",!1),document.body.classList.remove("ov-hidden"),lenis.start(),setTimeout(()=>l(t,"closing",!1),400)):(l(t,"show"),l(n,"show"),document.body.classList.add("ov-hidden"),lenis.stop())};e.addEventListener("click",()=>{let e=t.classList.contains("show");r(e)})}function setActiveLink(){if(window.innerWidth<=992)return;let e=document.querySelectorAll(".main-menu a"),t=window.location.pathname,n=null;e.forEach(e=>{let r=new URL(e.getAttribute("href"),window.location.origin).pathname,l=r.endsWith("/homes")&&t.startsWith("/homes/");(r===t||l)&&(e.classList.add("active"),n=e)});let r=(t=null)=>{e.forEach(e=>{e.style.opacity=t?e===t?"1":"0.3":n?e===n?"1":"0.3":"1"})};e.forEach(e=>{e.addEventListener("mouseenter",()=>r(e)),e.addEventListener("mouseleave",()=>r())}),r()}function subNavHoverEffect(){let e=document.querySelectorAll(".hover-link");if(!e.length)return;let t=null,n=e[0],r=document.getElementById(`${n.id}-img`);r&&(r.style.opacity="1",t=r),n.style.opacity="1",e.forEach(n=>{n.addEventListener("mouseenter",()=>{let r=document.getElementById(`${n.id}-img`);r&&r!==t&&(t?.style.setProperty("opacity","0"),r.style.opacity="1",t=r),e.forEach(e=>e.style.opacity=e===n?"1":"0.3")})})}function lazyImages(){if("IntersectionObserver"in window){let e=document.querySelectorAll("img.lazy"),t=(e,t)=>{e.forEach(e=>{if(e.isIntersecting){let n=e.target;n.src=n.getAttribute("data-src"),n.classList.remove("lazy"),t.unobserve(n)}})},n=new IntersectionObserver(t,{root:null,rootMargin:"0px 0px -25px 0px"});e.forEach(e=>{n.observe(e)})}else{let r=document.querySelectorAll("img.lazy");r.forEach(e=>{e.src=e.getAttribute("data-src")})}}function gallery(){let e=document.getElementById("image-popup");if(!e)return;let t=e.querySelector(".popup-image"),n=e.querySelector(".close-btn"),r=e.querySelector(".next-btn"),l=e.querySelector(".prev-btn"),s=e.querySelector(".popup-counter"),i=Array.from(document.querySelectorAll(".gallery-image img")),o=0,a=0,c=0,d=0;function u(){let e=i[o],n=e.src||e.dataset.src,r=e.alt||"";t.classList.remove("visible");let l=new Image;l.onload=()=>{t.src=n,t.alt=r,s.textContent=`${o+1} / ${i.length}`,setTimeout(()=>t.classList.add("visible"),50)},l.src=n}function h(t){o=t,e.classList.add("show"),document.body.classList.add("ov-hidden"),lenis.stop(),setTimeout(u,10)}function g(){o=(o+1)%i.length,u()}function f(){o=(o-1+i.length)%i.length,u()}n?.addEventListener("click",function n(){e.classList.remove("show"),setTimeout(()=>{t.src="",s.textContent="",document.body.classList.remove("ov-hidden"),lenis.start()},300)}),r?.addEventListener("click",g),l?.addEventListener("click",f),t.addEventListener("touchstart",function e(t){t.touches.length>1||(a=c=t.touches[0].screenX,d=Date.now())},!1),t.addEventListener("touchmove",function e(t){t.touches.length>1||(c=t.touches[0].screenX)},!1),t.addEventListener("touchend",function e(){let t=c-a,n=Date.now()-d;Math.abs(t)>50&&n<500&&(t<0?g():f()),a=c=d=0},!1),i.forEach((e,t)=>e.addEventListener("click",()=>h(t))),document.querySelector(".open-gallery")?.addEventListener("click",()=>{i.length&&h(0)})}function projectFullSlider(){let e=document.querySelectorAll(".slide"),t=document.getElementById("project-slider"),n=document.getElementById("slide-counter"),r=document.getElementById("arrow-up"),l=document.getElementById("arrow-down"),s=document.querySelector(".fullpage-wrapper");if(!t||!n||!e.length||!s)return;let i=0,o=!1,a=0,c=!1;function d(){let e=window.innerHeight;s.style.height=`${e}px`,document.querySelectorAll(".project-hero, .slide").forEach(t=>{t.style.height=`${e}px`}),function e(){let n=window.innerHeight;t.style.transform=`translateY(-${i*n}px)`}()}function u(){n.textContent=`${i+1} / ${e.length}`}function h(n){if(o||n<0||n>=e.length)return;i=n;let s=window.innerHeight;t.style.transform=`translateY(-${i*s}px)`,e.forEach((e,t)=>{e.classList.toggle("active",t===i)}),r.disabled=0===i,l.disabled=i===e.length-1,u(),function e(t){let n=t.querySelector("img");n&&(n.classList.remove("image-pre-fade"),n.style.animation="none",n.offsetHeight,n.classList.add("image-pre-fade"),setTimeout(()=>{n.style.animation="fadeScaleIn 0.6s ease-out forwards"},500))}(e[i]),o=!0,setTimeout(()=>o=!1,1e3)}function g(){i<e.length-1&&h(i+1)}function f(){i>0&&h(i-1)}window.addEventListener("load",()=>{d(),u()}),window.addEventListener("resize",d),s.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),r?.addEventListener("click",f),l?.addEventListener("click",g),window.addEventListener("wheel",e=>{o||(e.deltaY>0?g():f())}),window.addEventListener("touchstart",e=>{a=e.touches[0].clientY,c=!0},{passive:!0}),window.addEventListener("touchend",e=>{if(!c||o)return;let t=a-e.changedTouches[0].clientY;Math.abs(t)>50&&(t>0?g():f()),c=!1})}function bodyFadeInOut(){let e=document.getElementById("transition-overlay");window.addEventListener("pageshow",()=>{document.body.classList.remove("page-exit"),e?.classList.remove("show")}),document.addEventListener("click",t=>{let n=t.target.closest("a[href]");if(!n)return;let r=n.getAttribute("href"),l=r.startsWith("http")||r.startsWith("mailto:");!r||r.startsWith("#")||l||"_blank"===n.target||(t.preventDefault(),e?.classList.add("show"),setTimeout(()=>{window.location.href=r},400))})}function loadHeader(){return fetch("../utilities/header.html").then(e=>e.text()).then(e=>{document.getElementById("header").innerHTML=e})}function loadFooter(){return fetch("../utilities/footer.html").then(e=>e.text()).then(e=>{document.getElementById("footer").innerHTML=e})}function initializeComponents(){scrollProgressBar(),backToHomes(),bodyFadeInOut(),staggerFade(),gallery(),fadeOutOnScroll(".project_down_arrow"),fadeOutOnScroll(".fade-out-element"),fadeInElements(),heroSlider(),lazyImages(),lenisScroll(),projectFullSlider(),waitBefore()}window.addEventListener("load",refreshLenis),document.addEventListener("DOMContentLoaded",()=>{loadHeader().then(()=>{menuToggle(),subNavHoverEffect(),setActiveLink()}).catch(e=>console.error("Failed to load header:",e)),document.body.classList.contains("no-footer")||loadFooter().catch(e=>console.error("Failed to load footer:",e)),initializeComponents()});